version: "3.8"
services:
  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: rootpass
      MYSQL_DATABASE: appdb
    volumes:
      - dbdata:/var/lib/mysql
      - ./mysql/init.sql:/docker-entrypoint-initdb.d/init.sql:ro
    ports: ["3306:3306"]

  user-service:
    build: ./backend/user-service
    environment:
      DB_HOST: mysql; DB_USER: root; DB_PASSWORD: rootpass; DB_NAME: appdb
    depends_on: [mysql]
    ports: ["4000:4000"]

  product-service:
    build: ./python-services/product-service
    environment:
      DB_HOST: mysql; DB_USER: root; DB_PASSWORD: rootpass; DB_NAME: appdb
    depends_on: [mysql]
    ports: ["4100:4100"]

  orders-service:
    build: ./backend/orders-service
    environment:
      DB_HOST: mysql; DB_USER: root; DB_PASSWORD: rootpass; DB_NAME: appdb
    depends_on: [user-service, product-service, mysql]
    ports: ["4200:4200"]

  api-gateway:
    build: ./backend/api-gateway
    depends_on: [user-service, product-service, orders-service]
    ports: ["3000:3000"]

volumes:
  dbdata:
